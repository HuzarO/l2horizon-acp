{% extends "layouts/base.html" %}
{% load static i18n %}

{% block title %}{% trans "Slot Machine Manager" %}{% endblock %}

{% block extrastyle %}
<style>
.mgr-bg { 
    background: radial-gradient(ellipse at center, #1a1a2e 0%, #121220 100%); 
    min-height: 100vh; 
    padding: 30px 0; 
}
.card-glow { 
    background: linear-gradient(to bottom right, #1a1a2e, #121220); 
    border: 2px solid #6f42c1; 
    border-radius: 12px; 
    box-shadow: 0 0 15px rgba(111,66,193,.5), 0 0 25px rgba(13,202,240,.3); 
}
.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    padding: 20px;
    color: white;
    margin-bottom: 20px;
}
.stat-value {
    font-size: 2.5rem;
    font-weight: bold;
}
.form-dark {
    background: rgba(255,255,255,0.05) !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    color: white !important;
}
.form-dark:focus {
    background: rgba(255,255,255,0.08) !important;
    border-color: #6f42c1 !important;
    color: white !important;
    box-shadow: 0 0 0 0.25rem rgba(111, 66, 193, 0.25) !important;
}
.form-select.form-dark,
select.form-dark {
    background: rgba(30, 30, 50, 0.95) !important;
    border: 1px solid rgba(255,255,255,0.2) !important;
    color: white !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 0.75rem center !important;
    background-size: 16px 12px !important;
}
.form-select.form-dark option,
select.form-dark option {
    background: #1a1a2e !important;
    color: white !important;
}
.form-check-input {
    background-color: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.3);
    width: 3em;
    height: 1.5em;
    cursor: pointer;
}
.form-check-input:checked {
    background-color: #198754;
    border-color: #198754;
}
.form-check-input:focus {
    border-color: #6f42c1;
    box-shadow: 0 0 0 0.25rem rgba(111, 66, 193, 0.25);
}
.btn-delete {
    background: #dc3545;
    border: none;
    color: white;
    padding: 5px 15px;
    border-radius: 5px;
    font-size: 0.875rem;
    cursor: pointer;
}
.btn-delete:hover {
    background: #c82333;
}
.btn-sm {
    font-size: 0.875rem;
    padding: 5px 10px;
}
.badge {
    font-size: 0.875rem;
    padding: 0.35em 0.65em;
}
</style>
{% endblock %}

{% block content %}
<div class="mgr-bg">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4 text-white">
            <h3 class="m-0">üé∞ {% trans "Gerenciar Slot Machine" %}</h3>
            <div>
                {% if not active_config or total_symbols == 0 %}
                <form method="post" style="display: inline;" class="me-2">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="quick_setup">
                    <button type="submit" class="btn btn-success rounded-pill">
                        ‚ö° {% trans "Setup R√°pido Completo" %}
                    </button>
                </form>
                {% endif %}
                <a href="{% url 'games:slot_machine_page' %}" class="btn btn-outline-info rounded-pill">
                    {% trans "Ver Slot Machine" %}
                </a>
            </div>
        </div>

        <!-- Alerta se n√£o tiver configura√ß√£o -->
        {% if not active_config %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading">üö® {% trans "Configura√ß√£o n√£o encontrada!" %}</h5>
            <p>{% trans "Voc√™ precisa criar uma configura√ß√£o primeiro." %}</p>
            <hr>
            <div class="d-flex gap-2">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="create_default_config">
                    <button type="submit" class="btn btn-success">
                        ‚ú® {% trans "Criar Configura√ß√£o Padr√£o" %}
                    </button>
                </form>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <!-- Alerta se n√£o tiver s√≠mbolos -->
        {% if active_config and total_symbols == 0 %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <h5 class="alert-heading">‚ö†Ô∏è {% trans "S√≠mbolos n√£o configurados!" %}</h5>
            <p>{% trans "Voc√™ precisa adicionar s√≠mbolos antes de usar o Slot Machine." %}</p>
            <hr>
            <div class="d-flex gap-2">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="auto_populate_symbols">
                    <button type="submit" class="btn btn-success">
                        ‚ú® {% trans "Popular S√≠mbolos Automaticamente" %}
                    </button>
                </form>
                <small class="text-muted align-self-center">
                    {% trans "Ou adicione manualmente abaixo" %}
                </small>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <!-- Alerta se n√£o tiver pr√™mios -->
        {% if total_symbols > 0 and total_prizes == 0 %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <h5 class="alert-heading">üí° {% trans "Pr√™mios n√£o configurados!" %}</h5>
            <p>{% trans "Configure os pr√™mios para cada combina√ß√£o de s√≠mbolos." %}</p>
            <hr>
            <div class="d-flex gap-2">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="auto_populate_prizes">
                    <button type="submit" class="btn btn-success">
                        ‚ú® {% trans "Popular Pr√™mios Automaticamente" %}
                    </button>
                </form>
                <small class="text-muted align-self-center">
                    {% trans "Ou adicione manualmente abaixo" %}
                </small>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <!-- Estat√≠sticas Principais -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div>{% trans "Total de Giros" %}</div>
                    <div class="stat-value">{{ total_spins }}</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>{% trans "Vit√≥rias" %}</div>
                    <div class="stat-value">{{ total_wins }}</div>
                    <small>{{ win_rate }}% win rate</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>{% trans "Jackpots" %}</div>
                    <div class="stat-value">{{ total_jackpots }}</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div>{% trans "Fichas Distribu√≠das" %}</div>
                    <div class="stat-value">{{ total_fichas_distributed }}</div>
                </div>
            </div>
        </div>

        <!-- Configura√ß√£o Ativa -->
        {% if active_config %}
        <div class="card card-glow mb-4" style="border-color: #fbbf24 !important; box-shadow: 0 0 20px rgba(251, 191, 36, 0.4) !important;">
            <div class="card-header text-white d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <strong style="font-size: 1.2rem;">‚öôÔ∏è {% trans "CONFIGURA√á√ÉO DO JOGO" %}</strong>
                <button class="btn btn-sm btn-light" data-bs-toggle="collapse" data-bs-target="#editConfig">
                    ‚úèÔ∏è {% trans "Editar" %}
                </button>
            </div>
            <div class="card-body" style="background: rgba(251, 191, 36, 0.05);">
                <div class="row text-white align-items-center">
                    <div class="col-md-2">
                        <strong>{% trans "Status" %}:</strong>
                        {% if active_config.is_active %}
                            <span class="badge bg-success">‚úÖ {% trans "Ativo" %}</span>
                        {% else %}
                            <span class="badge bg-danger">‚ùå {% trans "Inativo" %}</span>
                        {% endif %}
                    </div>
                    <div class="col-md-3">
                        <strong>{% trans "Nome" %}:</strong> {{ active_config.name }}
                    </div>
                    <div class="col-md-2">
                        <strong>{% trans "Custo/Giro" %}:</strong> {{ active_config.cost_per_spin }} fichas
                    </div>
                    <div class="col-md-2">
                        <strong>{% trans "Jackpot" %}:</strong> {{ active_config.jackpot_amount }}
                    </div>
                    <div class="col-md-3">
                        <strong>{% trans "Chance Jackpot" %}:</strong> {{ active_config.jackpot_chance }}%
                    </div>
                </div>
                
                <!-- Formul√°rio de Edi√ß√£o (colaps√°vel) -->
                <div class="collapse mt-3" id="editConfig">
                    <hr class="bg-secondary">
                    <form method="post" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="update_config">
                        <input type="hidden" name="config_id" value="{{ active_config.id }}">
                        
                        <div class="col-md-3">
                            <label class="text-white"><strong>{% trans "Nome" %}</strong></label>
                            <input type="text" name="name" class="form-control form-dark" value="{{ active_config.name }}" required>
                        </div>
                        <div class="col-md-2">
                            <label class="text-white"><strong>{% trans "Custo por Giro" %}</strong></label>
                            <input type="number" name="cost_per_spin" class="form-control form-dark" value="{{ active_config.cost_per_spin }}" min="1" required>
                        </div>
                        <div class="col-md-2">
                            <label class="text-white"><strong>{% trans "Jackpot Atual" %}</strong></label>
                            <input type="number" name="jackpot_amount" class="form-control form-dark" value="{{ active_config.jackpot_amount }}" min="0" required>
                        </div>
                        <div class="col-md-2">
                            <label class="text-white"><strong>{% trans "Chance Jackpot (%)" %}</strong></label>
                            <input type="number" name="jackpot_chance" class="form-control form-dark" value="{{ active_config.jackpot_chance }}" min="0" max="100" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <label class="text-white"><strong>{% trans "Status" %}</strong></label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" name="is_active" id="id_is_active" {% if active_config.is_active %}checked{% endif %}>
                                <label class="form-check-label text-white ms-2" for="id_is_active">
                                    {% trans "Jogo Ativo" %}
                                </label>
                            </div>
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button type="submit" class="btn btn-success w-100">üíæ {% trans "Salvar" %}</button>
                        </div>
                    </form>
                    
                    <div class="mt-3 p-3 bg-dark bg-opacity-25 rounded">
                        <small class="text-muted">
                            <strong>{% trans "Status:" %}</strong>
                            {% if active_config.is_active %}
                                <span class="text-success">‚úÖ {% trans "O jogo est√° dispon√≠vel para os jogadores" %}</span>
                            {% else %}
                                <span class="text-danger">‚ùå {% trans "O jogo est√° desativado e n√£o aparecer√° para os jogadores" %}</span>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <!-- GERENCIAR S√çMBOLOS -->
            <div class="col-lg-6 mb-4">
                <div class="card card-glow">
                    <div class="card-header text-white d-flex justify-content-between align-items-center">
                        <strong>üé∞ {% trans "Gerenciar S√≠mbolos" %} ({{ total_symbols }})</strong>
                        <div>
                            {% if total_symbols == 0 %}
                            <form method="post" style="display: inline;" class="me-2">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="auto_populate_symbols">
                                <button type="submit" class="btn btn-sm btn-warning">
                                    ‚ú® {% trans "Popular Auto" %}
                                </button>
                            </form>
                            {% endif %}
                            <button class="btn btn-sm btn-success" data-bs-toggle="collapse" data-bs-target="#addSymbol">
                                ‚ûï {% trans "Adicionar" %}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formul√°rio Adicionar S√≠mbolo -->
                    <div class="collapse" id="addSymbol">
                        <div class="card-body border-bottom border-secondary">
                            <form method="post" class="row g-3">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="add_symbol">
                                
                                <div class="col-md-4">
                                    <label class="text-white">{% trans "S√≠mbolo" %}</label>
                                    {{ symbol_form.symbol }}
                                </div>
                                <div class="col-md-3">
                                    <label class="text-white">{% trans "√çcone/Emoji" %}</label>
                                    {{ symbol_form.icon }}
                                </div>
                                <div class="col-md-3">
                                    <label class="text-white">{% trans "Peso" %}</label>
                                    {{ symbol_form.weight }}
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-success w-100">‚ûï</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Lista de S√≠mbolos -->
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-dark table-striped mb-0">
                                <thead>
                                    <tr>
                                        <th>{% trans "S√≠mbolo" %}</th>
                                        <th>{% trans "Nome" %}</th>
                                        <th>{% trans "Peso" %}</th>
                                        <th class="text-end">{% trans "A√ß√µes" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for symbol in symbols %}
                                    <tr>
                                        <td style="font-size: 2rem;">{{ symbol.icon }}</td>
                                        <td>{{ symbol.get_symbol_display }}</td>
                                        <td>{{ symbol.weight }}</td>
                                        <td class="text-end">
                                            <button class="btn btn-sm btn-warning me-2" data-bs-toggle="collapse" data-bs-target="#editSymbol{{ symbol.id }}">
                                                ‚úèÔ∏è {% trans "Editar" %}
                                            </button>
                                            <form method="post" style="display:inline;" onsubmit="return confirm('{% trans "Tem certeza que deseja remover este s√≠mbolo?" %}');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="delete_symbol">
                                                <input type="hidden" name="symbol_id" value="{{ symbol.id }}">
                                                <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <!-- Formul√°rio de Edi√ß√£o -->
                                    <tr class="collapse" id="editSymbol{{ symbol.id }}">
                                        <td colspan="4" style="background: rgba(255, 193, 7, 0.1); padding: 20px;">
                                            <form method="post" class="row g-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="edit_symbol">
                                                <input type="hidden" name="symbol_id" value="{{ symbol.id }}">
                                                
                                                <div class="col-12 mb-2">
                                                    <strong class="text-warning">‚úèÔ∏è {% trans "Editando:" %} {{ symbol.get_symbol_display }}</strong>
                                                </div>
                                                
                                                <div class="col-md-4">
                                                    <label class="text-white">{% trans "S√≠mbolo" %}</label>
                                                    <input type="text" name="symbol" class="form-control form-dark" value="{{ symbol.symbol }}" required>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="text-white">{% trans "√çcone/Emoji" %}</label>
                                                    <input type="text" name="icon" class="form-control form-dark" value="{{ symbol.icon }}" maxlength="10">
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="text-white">{% trans "Peso (Probabilidade)" %}</label>
                                                    <input type="number" name="weight" class="form-control form-dark" value="{{ symbol.weight }}" min="1" required>
                                                </div>
                                                <div class="col-md-2 d-flex align-items-end gap-2">
                                                    <button type="submit" class="btn btn-success">üíæ {% trans "Salvar" %}</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#editSymbol{{ symbol.id }}">‚ùå</button>
                                                </div>
                                            </form>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">
                                            {% trans "Nenhum s√≠mbolo configurado. Adicione s√≠mbolos antes de criar pr√™mios!" %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GERENCIAR PR√äMIOS -->
            <div class="col-lg-6 mb-4">
                <div class="card card-glow">
                    <div class="card-header text-white d-flex justify-content-between align-items-center">
                        <strong>üèÜ {% trans "Gerenciar Pr√™mios" %} ({{ total_prizes }})</strong>
                        <div>
                            {% if total_symbols > 0 and total_prizes == 0 %}
                            <form method="post" style="display: inline;" class="me-2">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="auto_populate_prizes">
                                <button type="submit" class="btn btn-sm btn-warning">
                                    ‚ú® {% trans "Popular Auto" %}
                                </button>
                            </form>
                            {% endif %}
                            <button class="btn btn-sm btn-success" data-bs-toggle="collapse" data-bs-target="#addPrize">
                                ‚ûï {% trans "Adicionar" %}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Formul√°rio Adicionar Pr√™mio -->
                    <div class="collapse" id="addPrize">
                        <div class="card-body border-bottom border-secondary">
                            <form method="post" class="row g-3">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="add_prize">
                                <input type="hidden" name="config_id" value="{{ active_config.id }}">
                                
                                <div class="col-md-3">
                                    <label class="text-white">{% trans "S√≠mbolo" %}</label>
                                    {{ prize_form.symbol }}
                                </div>
                                <div class="col-md-2">
                                    <label class="text-white">{% trans "Combina√ß√µes" %}</label>
                                    {{ prize_form.matches_required }}
                                </div>
                                <div class="col-md-3">
                                    <label class="text-white">{% trans "Item (opcional)" %}</label>
                                    {{ prize_form.item }}
                                </div>
                                <div class="col-md-2">
                                    <label class="text-white">{% trans "Fichas" %}</label>
                                    {{ prize_form.fichas_prize }}
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-success w-100">‚ûï {% trans "Adicionar" %}</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Lista de Pr√™mios -->
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-dark table-striped mb-0">
                                <thead>
                                    <tr>
                                        <th>{% trans "Combina√ß√£o" %}</th>
                                        <th>{% trans "Pr√™mio Fichas" %}</th>
                                        <th>{% trans "Item" %}</th>
                                        <th class="text-end">{% trans "A√ß√µes" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for prize in prizes %}
                                    <tr>
                                        <td>{{ prize.matches_required }}x {{ prize.symbol.icon }} {{ prize.symbol.get_symbol_display }}</td>
                                        <td>{{ prize.fichas_prize }} fichas</td>
                                        <td>
                                            {% if prize.item %}
                                                {{ prize.item.name }} +{{ prize.item.enchant }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-sm btn-warning me-2" data-bs-toggle="collapse" data-bs-target="#editPrize{{ prize.id }}">
                                                ‚úèÔ∏è {% trans "Editar" %}
                                            </button>
                                            <form method="post" style="display:inline;" onsubmit="return confirm('{% trans "Tem certeza que deseja remover este pr√™mio?" %}');">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="delete_prize">
                                                <input type="hidden" name="prize_id" value="{{ prize.id }}">
                                                <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <!-- Formul√°rio de Edi√ß√£o -->
                                    <tr class="collapse" id="editPrize{{ prize.id }}">
                                        <td colspan="4" style="background: rgba(255, 193, 7, 0.1); padding: 20px;">
                                            <form method="post" class="row g-3">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="edit_prize">
                                                <input type="hidden" name="prize_id" value="{{ prize.id }}">
                                                
                                                <div class="col-12 mb-2">
                                                    <strong class="text-warning">‚úèÔ∏è {% trans "Editando pr√™mio:" %} {{ prize.symbol.get_symbol_display }}</strong>
                                                </div>
                                                
                                                <div class="col-md-3">
                                                    <label class="text-white">{% trans "S√≠mbolo" %}</label>
                                                    <select name="symbol" class="form-select form-dark" required>
                                                        {% for sym in symbols %}
                                                        <option value="{{ sym.id }}" {% if prize.symbol.id == sym.id %}selected{% endif %}>
                                                            {{ sym.icon }} {{ sym.get_symbol_display }}
                                                        </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="text-white">{% trans "Combina√ß√µes" %}</label>
                                                    <input type="number" name="matches_required" class="form-control form-dark" value="{{ prize.matches_required }}" min="1" max="3" required>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="text-white">{% trans "Item (opcional)" %}</label>
                                                    <select name="item" class="form-select form-dark">
                                                        <option value="">-- {% trans "Nenhum" %} --</option>
                                                        {% for item in items %}
                                                        <option value="{{ item.id }}" {% if prize.item and prize.item.id == item.id %}selected{% endif %}>{{ item.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="text-white">{% trans "Fichas" %}</label>
                                                    <input type="number" name="fichas_prize" class="form-control form-dark" value="{{ prize.fichas_prize }}" min="0" required>
                                                </div>
                                                <div class="col-md-2 d-flex align-items-end gap-2">
                                                    <button type="submit" class="btn btn-success">üíæ {% trans "Salvar" %}</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#editPrize{{ prize.id }}">‚ùå</button>
                                                </div>
                                            </form>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">{% trans "Nenhum pr√™mio configurado" %}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Top Ganhadores e Estat√≠sticas -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card card-glow">
                    <div class="card-header text-white-50">
                        <strong>üèÜ {% trans "Top 10 Ganhadores" %}</strong>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-dark table-striped mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>{% trans "Jogador" %}</th>
                                        <th>{% trans "Total Ganho" %}</th>
                                        <th>{% trans "Jogadas" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for winner in top_winners %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ winner.user__username }}</td>
                                        <td class="text-success">{{ winner.total_won }}</td>
                                        <td>{{ winner.total_plays }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card card-glow">
                    <div class="card-header text-white-50">
                        <strong>üìä {% trans "Estat√≠sticas Gerais" %}</strong>
                    </div>
                    <div class="card-body text-white">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <h4>{{ total_symbols }}</h4>
                                <small>{% trans "S√≠mbolos" %}</small>
                            </div>
                            <div class="col-6 mb-3">
                                <h4>{{ total_prizes }}</h4>
                                <small>{% trans "Pr√™mios" %}</small>
                            </div>
                            <div class="col-6">
                                <h4>{{ win_rate }}%</h4>
                                <small>{% trans "Taxa de Vit√≥ria" %}</small>
                            </div>
                            <div class="col-6">
                                <h4>{{ total_jackpots }}</h4>
                                <small>{% trans "Jackpots" %}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √öltimas Jogadas -->
        <div class="card card-glow">
            <div class="card-header text-white-50">
                <strong>üìä {% trans "√öltimas 20 Jogadas" %}</strong>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-striped mb-0">
                        <thead>
                            <tr>
                                <th>{% trans "Data" %}</th>
                                <th>{% trans "Jogador" %}</th>
                                <th>{% trans "Resultado" %}</th>
                                <th>{% trans "Pr√™mio" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for play in recent_plays %}
                            <tr>
                                <td>{{ play.created_at|date:"d/m/Y H:i" }}</td>
                                <td>{{ play.user.username }}</td>
                                <td>
                                    {% if play.is_jackpot %}
                                        <span class="badge bg-warning">üíé JACKPOT!</span>
                                    {% elif play.prize_won %}
                                        <span class="badge bg-success">Ganhou</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Perdeu</span>
                                    {% endif %}
                                </td>
                                <td class="{% if play.fichas_won > 0 %}text-success{% else %}text-muted{% endif %}">
                                    {% if play.fichas_won > 0 %}
                                        +{{ play.fichas_won }} fichas
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <p class="text-white-50">
                üí° {% trans "Dica: Use itens do sistema existente para pr√™mios!" %}
            </p>
        </div>
    </div>
</div>

<script>
// Aplicar classes aos forms
document.querySelectorAll('.form-control, .form-select').forEach(el => {
    el.classList.add('form-dark');
});
</script>
{% endblock %}
